---
apiVersion: akri.microsoft.com/v1beta1
kind: ConnectorTemplate
metadata:
  name: '{{ .Values.device.name | default "device-001" }}-aio-connector-template'
  namespace: {{ default "azure-iot-operations" }}
spec:
   version: "0.0.1"
   deviceInboundEndpointTypes:
   - endpointType: {{ .Values.device.inboundEndpoint.type | default "device-endpoint-type-001" }}
     version: "0.0.1"
   runtimeConfiguration:
     runtimeConfigurationType: managedConfiguration
     managedConfigurationSettings:
      managedConfigurationType: imageConfiguration
      imageConfigurationSettings:
        imageName: {{ .Values.image.name }}
        imagePullPolicy: Always # This sample image is built locally, so no need to pull
        replicas: {{ .Values.replicas | default 1 }}
        tagDigestSettings:
          tagDigestType: tag
          tag: {{ .Values.image.tag | default .Chart.AppVersion }}
   mqttConnectionConfiguration:
     host: "aio-broker:18883"
     authentication:
      method: ServiceAccountToken
      serviceAccountTokenSettings:
        audience: aio-internal
     tls:
       mode: Enabled
       trustedCaCertificateConfigMapRef: azure-iot-operations-aio-ca-trust-bundle
